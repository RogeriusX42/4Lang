<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCHOLAR.EXE: Ferramenta de Voz e Texto de Quatro Pain√©is</title>
    <!-- Tailwind CSS CDN para um estilo bonito e responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter para um visual limpo e moderno -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos personalizados para a fonte Inter e estilo geral do corpo */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Fundo azul-acinzentado claro */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px; /* Adiciona algum preenchimento para telas menores */
            box-sizing: border-box; /* Inclui preenchimento na largura e altura total do elemento */
        }

        /* Anima√ß√£o personalizada para o √≠cone do microfone pulsante */
        @keyframes pulse-red {
            0%, 100% {
                color: currentColor;
                transform: scale(1);
            }
            50% {
                color: #ef4444; /* vermelho-500 */
                transform: scale(1.1);
            }
        }
        .animate-pulse-red {
            animation: pulse-red 1.5s infinite ease-in-out;
        }

        /* Estilo para links de pesquisa */
        .research-links a {
            color: #2563eb; /* blue-600 */
            text-decoration: underline;
            word-break: break-all; /* Quebra URLs longas */
        }
        .research-links a:hover {
            color: #1d4ed8; /* blue-700 */
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-6 bg-white shadow-xl rounded-xl max-w-4xl w-full transform transition-all duration-300 hover:scale-105">
        <h1 class="text-4xl font-extrabold text-center text-gray-900 mb-8 drop-shadow-sm">
            üó£Ô∏è Ferramenta de Voz e Texto de Quatro Pain√©is üìù
        </h1>

        <!-- Caixa de mensagem para feedback do utilizador (ex: erros, carregamento) -->
        <div id="message-box" class="mt-4 mb-6 p-4 bg-yellow-100 border border-yellow-400 text-yellow-800 rounded-lg hidden" role="alert">
            <!-- As mensagens aparecer√£o aqui -->
        </div>

        <!-- Grelha para quatro √°reas de idioma -->
        <div id="language-areas-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- √Årea de Idioma 1 -->
            <div class="language-area p-5 border border-gray-200 rounded-lg shadow-md bg-gray-50">
                <label for="text-area-0" class="block text-lg font-semibold text-gray-700 mb-2">
                    <span id="lang-label-0">Idioma 1</span>:
                </label>
                <select id="lang-select-0" class="w-full p-3 border-2 border-gray-300 rounded-lg bg-white focus:ring-4 focus:ring-blue-500 focus:border-blue-500 transition duration-200 ease-in-out shadow-sm cursor-pointer mb-4"></select>
                <textarea id="text-area-0" class="w-full p-4 border-2 border-gray-300 rounded-lg focus:ring-4 focus:ring-blue-500 focus:border-blue-500 transition duration-200 ease-in-out resize-y min-h-[120px] shadow-sm" placeholder="Introduza texto ou grave voz..." aria-label="√Årea de texto do Painel 1"></textarea>
                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mt-4">
                    <button id="speak-button-0" class="flex-1 bg-gradient-to-r from-blue-600 to-indigo-700 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-blue-700 hover:to-indigo-800 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95">
                        <span class="flex items-center justify-center">üîä Falar</span>
                    </button>
                    <button id="record-button-0" class="flex-1 bg-gradient-to-r from-green-500 to-teal-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-green-600 hover:to-teal-700 focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"></path></svg>
                        <span class="record-button-text">Gravar</span>
                    </button>
                </div>
                <button id="stop-speak-button-0" class="w-full bg-gradient-to-r from-gray-500 to-gray-700 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-gray-600 hover:to-gray-800 focus:outline-none focus:ring-4 focus:ring-gray-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95 mt-2" disabled>
                    ‚èπÔ∏è Parar de Falar
                </button>
                <button id="llm-button-0" class="w-full bg-gradient-to-r from-purple-600 to-pink-700 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-purple-700 hover:to-pink-800 focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95 mt-4">
                    ‚ú® Gerar Ideias ‚ú®
                </button>
                <button id="research-button-0" class="w-full bg-gradient-to-r from-orange-500 to-red-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-orange-600 hover:to-red-700 focus:outline-none focus:ring-4 focus:ring-orange-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95 mt-2">
                    üî¨ Pesquisar Artigos Cient√≠ficos üî¨
                </button>
                <div id="research-links-0" class="research-links mt-4 p-3 bg-gray-100 rounded-lg border border-gray-200 text-sm text-gray-700">
                    <!-- Links de pesquisa aparecer√£o aqui -->
                </div>
            </div>

            <!-- √Årea de Idioma 2 -->
            <div class="language-area p-5 border border-gray-200 rounded-lg shadow-md bg-gray-50">
                <label for="text-area-1" class="block text-lg font-semibold text-gray-700 mb-2">
                    <span id="lang-label-1">Idioma 2</span>:
                </label>
                <select id="lang-select-1" class="w-full p-3 border-2 border-gray-300 rounded-lg bg-white focus:ring-4 focus:ring-blue-500 focus:border-blue-500 transition duration-200 ease-in-out shadow-sm cursor-pointer mb-4"></select>
                <textarea id="text-area-1" class="w-full p-4 border-2 border-gray-300 rounded-lg focus:ring-4 focus:ring-blue-500 focus:border-blue-500 transition duration-200 ease-in-out resize-y min-h-[120px] shadow-sm" placeholder="Introduza texto ou grave voz..." aria-label="√Årea de texto do Painel 2"></textarea>
                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mt-4">
                    <button id="speak-button-1" class="flex-1 bg-gradient-to-r from-blue-600 to-indigo-700 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-blue-700 hover:to-indigo-800 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95">
                        <span class="flex items-center justify-center">üîä Falar</span>
                    </button>
                    <button id="record-button-1" class="flex-1 bg-gradient-to-r from-green-500 to-teal-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-green-600 hover:to-teal-700 focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"></path></svg>
                        <span class="record-button-text">Gravar</span>
                    </button>
                </div>
                <button id="stop-speak-button-1" class="w-full bg-gradient-to-r from-gray-500 to-gray-700 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-gray-600 hover:to-gray-800 focus:outline-none focus:ring-4 focus:ring-gray-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95 mt-2" disabled>
                    ‚èπÔ∏è Parar de Falar
                </button>
                <button id="llm-button-1" class="w-full bg-gradient-to-r from-purple-600 to-pink-700 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-purple-700 hover:to-pink-800 focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95 mt-4">
                    ‚ú® Gerar Ideias ‚ú®
                </button>
                <button id="research-button-1" class="w-full bg-gradient-to-r from-orange-500 to-red-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-orange-600 hover:to-red-700 focus:outline-none focus:ring-4 focus:ring-orange-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95 mt-2">
                    üî¨ Pesquisar Artigos Cient√≠ficos üî¨
                </button>
                <div id="research-links-1" class="research-links mt-4 p-3 bg-gray-100 rounded-lg border border-gray-200 text-sm text-gray-700">
                    <!-- Links de pesquisa aparecer√£o aqui -->
                </div>
            </div>

            <!-- √Årea de Idioma 3 -->
            <div class="language-area p-5 border border-gray-200 rounded-lg shadow-md bg-gray-50">
                <label for="text-area-2" class="block text-lg font-semibold text-gray-700 mb-2">
                    <span id="lang-label-2">Idioma 3</span>:
                </label>
                <select id="lang-select-2" class="w-full p-3 border-2 border-gray-300 rounded-lg bg-white focus:ring-4 focus:ring-blue-500 focus:border-blue-500 transition duration-200 ease-in-out shadow-sm cursor-pointer mb-4"></select>
                <textarea id="text-area-2" class="w-full p-4 border-2 border-gray-300 rounded-lg focus:ring-4 focus:ring-blue-500 focus:border-blue-500 transition duration-200 ease-in-out resize-y min-h-[120px] shadow-sm" placeholder="Introduza texto ou grave voz..." aria-label="√Årea de texto do Painel 3"></textarea>
                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mt-4">
                    <button id="speak-button-2" class="flex-1 bg-gradient-to-r from-blue-600 to-indigo-700 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-blue-700 hover:to-indigo-800 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95">
                        <span class="flex items-center justify-center">üîä Falar</span>
                    </button>
                    <button id="record-button-2" class="flex-1 bg-gradient-to-r from-green-500 to-teal-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-green-600 hover:to-teal-700 focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"></path></svg>
                        <span class="record-button-text">Gravar</span>
                    </button>
                </div>
                <button id="stop-speak-button-2" class="w-full bg-gradient-to-r from-gray-500 to-gray-700 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-gray-600 hover:to-gray-800 focus:outline-none focus:ring-4 focus:ring-gray-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95 mt-2" disabled>
                    ‚èπÔ∏è Parar de Falar
                </button>
                <button id="llm-button-2" class="w-full bg-gradient-to-r from-purple-600 to-pink-700 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-purple-700 hover:to-pink-800 focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95 mt-4">
                    ‚ú® Gerar Ideias ‚ú®
                </button>
                <button id="research-button-2" class="w-full bg-gradient-to-r from-orange-500 to-red-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-orange-600 hover:to-red-700 focus:outline-none focus:ring-4 focus:ring-orange-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95 mt-2">
                    üî¨ Pesquisar Artigos Cient√≠ficos üî¨
                </button>
                <div id="research-links-2" class="research-links mt-4 p-3 bg-gray-100 rounded-lg border border-gray-200 text-sm text-gray-700">
                    <!-- Links de pesquisa aparecer√£o aqui -->
                </div>
            </div>

            <!-- √Årea de Idioma 4 -->
            <div class="language-area p-5 border border-gray-200 rounded-lg shadow-md bg-gray-50">
                <label for="text-area-3" class="block text-lg font-semibold text-gray-700 mb-2">
                    <span id="lang-label-3">Idioma 4</span>:
                </label>
                <select id="lang-select-3" class="w-full p-3 border-2 border-gray-300 rounded-lg bg-white focus:ring-4 focus:ring-blue-500 focus:border-blue-500 transition duration-200 ease-in-out shadow-sm cursor-pointer mb-4"></select>
                <textarea id="text-area-3" class="w-full p-4 border-2 border-gray-300 rounded-lg focus:ring-4 focus:ring-blue-500 focus:border-blue-500 transition duration-200 ease-in-out resize-y min-h-[120px] shadow-sm" placeholder="Introduza texto ou grave voz..." aria-label="√Årea de texto do Painel 4"></textarea>
                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mt-4">
                    <button id="speak-button-3" class="flex-1 bg-gradient-to-r from-blue-600 to-indigo-700 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-blue-700 hover:to-indigo-800 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95">
                        <span class="flex items-center justify-center">üîä Falar</span>
                    </button>
                    <button id="record-button-3" class="flex-1 bg-gradient-to-r from-green-500 to-teal-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-green-600 hover:to-teal-700 focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"></path></svg>
                        <span class="record-button-text">Gravar</span>
                    </button>
                </div>
                <button id="stop-speak-button-3" class="w-full bg-gradient-to-r from-gray-500 to-gray-700 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-gray-600 hover:to-gray-800 focus:outline-none focus:ring-4 focus:ring-gray-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95 mt-2" disabled>
                    ‚èπÔ∏è Parar de Falar
                </button>
                <button id="llm-button-3" class="w-full bg-gradient-to-r from-purple-600 to-pink-700 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-purple-700 hover:to-pink-800 focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95 mt-4">
                    ‚ú® Gerar Ideias ‚ú®
                </button>
                <div id="research-links-3" class="research-links mt-4 p-3 bg-gray-100 rounded-lg border border-gray-200 text-sm text-gray-700">
                    <!-- Links de pesquisa aparecer√£o aqui -->
                </div>
                <button id="research-button-3" class="w-full bg-gradient-to-r from-orange-500 to-red-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:from-orange-600 hover:to-red-700 focus:outline-none focus:ring-4 focus:ring-orange-500 focus:ring-opacity-75 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95 mt-2">
                    üî¨ Pesquisar Artigos Cient√≠ficos üî¨
                </button>
            </div>
        </div>
    </div>

    <script>
        // Array para guardar refer√™ncias aos elementos de cada √°rea de idioma
        const languageAreas = [];
        for (let i = 0; i < 4; i++) {
            languageAreas.push({
                textArea: document.getElementById(`text-area-${i}`),
                langSelect: document.getElementById(`lang-select-${i}`),
                langLabel: document.getElementById(`lang-label-${i}`), // Refer√™ncia √† etiqueta din√¢mica
                speakButton: document.getElementById(`speak-button-${i}`),
                recordButton: document.getElementById(`record-button-${i}`),
                recordButtonText: document.querySelector(`#record-button-${i} .record-button-text`),
                micIcon: document.querySelector(`#record-button-${i} svg`),
                stopSpeakButton: document.getElementById(`stop-speak-button-${i}`), // Nova: refer√™ncia ao bot√£o de parar de falar
                llmButton: document.getElementById(`llm-button-${i}`), // Refer√™ncia ao bot√£o LLM de ideias
                researchButton: document.getElementById(`research-button-${i}`), // Refer√™ncia ao bot√£o de pesquisa
                researchLinksDiv: document.getElementById(`research-links-${i}`), // Refer√™ncia √† div de links
                currentVoice: null, // Para guardar o objeto de voz TTS selecionado
                recognition: null, // Para guardar a inst√¢ncia de SpeechRecognition
            });
        }

        const messageBox = document.getElementById('message-box');

        // Idiomas suportados para STT/TTS (c√≥digos ISO 639-1, com variantes comuns para melhor correspond√™ncia de voz)
        const supportedLanguages = [
            { code: 'en-US', name: 'English (US)', llm_prompt: 'Generate some ideas or expand the following English text:', llm_research_prompt: 'List 3 to 5 relevant research papers (title and URL) on the topic of the following English text. Format as a Markdown unordered list, with each item being `[Title](URL)`.' },
            { code: 'en-GB', name: 'English (UK)', llm_prompt: 'Generate some ideas or expand the following English text:', llm_research_prompt: 'List 3 to 5 relevant research papers (title and URL) on the topic of the following English text. Format as a Markdown unordered list, with each item being `[Title](URL)`.' },
            { code: 'es-ES', name: 'Spanish (Spain)', llm_prompt: 'Genera algunas ideas o expande el siguiente texto en espa√±ol:', llm_research_prompt: 'Enumera de 3 a 5 art√≠culos de investigaci√≥n relevantes (t√≠tulo y URL) sobre el tema del siguiente texto en espa√±ol. Formatea como una lista desordenada de Markdown, con cada elemento siendo `[T√≠tulo](URL)`.' },
            { code: 'fr-FR', name: 'French (France)', llm_prompt: 'G√©n√©rer des id√©es ou d√©velopper le texto franc√™s seguinte :', llm_research_prompt: 'Listez 3 √† 5 articles de recherche pertinents (titre et URL) sur le sujet du texte fran√ßais suivant. Formatez sous forme de liste non ordonn√©e Markdown, chaque √©l√©ment √©tant `[Titre](URL)`.' },
            { code: 'de-DE', name: 'Deutsch (Germany)', llm_prompt: 'Generieren Sie Ideen ou erweitern Sie den folgenden deutschen Text:', llm_research_prompt: 'Listen Sie 3 bis 5 relevante Forschungsarbeiten (Titel und URL) zum Thema des folgenden deutschen Textes auf. Formatieren Sie diese als ungeordnete Markdown-Liste, wobei jedes Element `[Titel](URL)` ist.' },
            { code: 'it-IT', name: 'Italian (Italy)', llm_prompt: 'Genera alcune idee ou espandi il seguente testo italiano:', llm_research_prompt: 'Elenca da 3 a 5 articoli di ricerca pertinenti (t√≠tulo e URL) sull\'argomento del seguente testo italiano. Formatta come un elenco non ordinato Markdown, con ogni elemento che √® `[Titolo](URL)`.' },
            { code: 'pt-BR', name: 'Portuguese (Brazil)', llm_prompt: 'Gere algumas ideias ou expanda o seguinte texto em portugu√™s do Brasil:', llm_research_prompt: 'Liste de 3 a 5 artigos de pesquisa relevantes (t√≠tulo e URL) sobre o tema do seguinte texto em portugu√™s do Brasil. Formate como uma lista n√£o ordenada de Markdown, com cada item sendo `[T√≠tulo](URL)`.' },
            { code: 'pt-PT', name: 'Portuguese (Portugal)', llm_prompt: 'Gere algumas ideias ou expanda o seguinte texto em portugu√™s de Portugal:', llm_research_prompt: 'Liste de 3 a 5 artigos de investiga√ß√£o relevantes (t√≠tulo e URL) sobre o tema do seguinte texto em portugu√™s de Portugal. Formate como uma lista n√£o ordenada de Markdown, com cada item sendo `[T√≠tulo](URL)`.' },
            { code: 'ja-JP', name: 'Japanese (Japan)', llm_prompt: 'Ê¨°„ÅÆÊó•Êú¨Ë™û„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Å´„Å§„ÅÑ„Å¶„Ç¢„Ç§„Éá„Ç¢„ÇíÁîüÊàê„Åô„Çã„Åã„ÄÅÂ±ïÈñã„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', llm_research_prompt: 'Ê¨°„ÅÆÊó•Êú¨Ë™û„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Å´Èñ¢„Åô„ÇãÈñ¢ÈÄ£Á†îÁ©∂Ë´ñÊñáÔºà„Çø„Ç§„Éà„É´„Å®URLÔºâ„Çí3„Äú5‰ª∂„É™„Çπ„Éà„Ç¢„ÉÉ„Éó„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÂêÑÈ†ÖÁõÆ„Çí`[„Çø„Ç§„Éà„É´](URL)`„Å®„Åô„ÇãMarkdown„ÅÆÈ†ÜÂ∫è„Å™„Åó„É™„Çπ„Éà„Å®„Åó„Å¶„Éï„Ç©„Éº„Éû„ÉÉ„Éà„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ' },
            { code: 'ko-KR', name: 'Korean (Korea)', llm_prompt: 'Îã§Ïùå ÌïúÍµ≠Ïñ¥ ÌÖçÏä§Ìä∏Ïóê ÎåÄÌïú ÏïÑÏù¥ÎîîÏñ¥Î•º ÏÉùÏÑ±ÌïòÍ±∞ÎÇò ÌôïÏû•ÌïòÏÑ∏Ïöî.', llm_research_prompt: 'Îã§Ïùå ÌïúÍµ≠Ïñ¥ ÌÖçÏä§Ìä∏ Ï£ºÏ†úÏóê ÎåÄÌïú Í¥ÄÎ†® Ïó∞Íµ¨ ÎÖºÎ¨∏(Ï†úÎ™© Î∞è URL)ÏùÑ 3~5Í∞ú ÎÇòÏó¥ÌïòÏã≠ÏãúÏò§. Í∞Å Ìï≠Î™©Ïù¥ `[Ï†úÎ™©](URL)`Ïù∏ ÎßàÌÅ¨Îã§Ïö¥ ÏàúÏÑú ÏóÜÎäî Î™©Î°ùÏúºÎ°ú Ìè¨Îß∑ÌïòÏã≠ÏãúÏò§.' },
            { code: 'zh-CN', name: 'Chinese (Mandarin)', llm_prompt: 'ÁîüÊàê‰∏Ä‰∫õÊÉ≥Ê≥ï ou expandir o seguinte texto em chin√™s:', llm_research_prompt: 'ÂàóÂá∫‰∏é‰ª•‰∏ã‰∏≠ÊñáÊñáÊú¨‰∏ªÈ¢òÁõ∏ÂÖ≥ÁöÑ3Âà∞5ÁØáÁ†îÁ©∂ËÆ∫ÊñáÔºàÊ†áÈ¢ò e URLÔºâ„ÄÇËØ∑‰ª•MarkdownÊó†Â∫èÂàóË°®ÁöÑÂΩ¢ÂºèËøõË°åÊ†ºÂºèÂåñÔºåÊØè‰∏™È°πÁõÆ‰∏∫`[Ê†áÈ¢ò](URL)`„ÄÇ' },
            { code: 'ar-SA', name: 'Arabic (Saudi Arabia)', llm_prompt: 'ŸÇŸÖ ÿ®ÿ™ŸàŸÑŸäÿØ ÿ®ÿπÿ∂ ÿßŸÑÿ£ŸÅŸÉÿßÿ± ou expandir o seguinte texto em √°rabe:', llm_research_prompt: 'ÿßÿ∞ŸÉÿ± ŸÖŸÜ 3 ÿ•ŸÑŸâ 5 ÿ£Ÿàÿ±ÿßŸÇ ÿ®ÿ≠ÿ´Ÿäÿ© ÿ∞ÿßÿ™ ÿµŸÑÿ© (ÿßŸÑÿπŸÜŸàÿßŸÜ e ÿ±ÿßÿ®ÿ∑ URL) ÿ≠ŸàŸÑ ŸÖŸàÿ∂Ÿàÿπ ÿßŸÑŸÜÿµ ÿßŸÑÿπÿ±ÿ®Ÿä ÿßŸÑÿ™ÿßŸÑŸä. ŸÇŸÖ ÿ®ÿ™ŸÜÿ≥ŸäŸÇŸáÿß ŸÉŸÇÿßÿ¶ŸÖÿ© Markdown ÿ∫Ÿäÿ± ŸÖÿ±ÿ™ÿ®ÿ©ÿå com cada elemento ŸäŸÉŸàŸÜ `[ÿßŸÑÿπŸÜŸàÿßŸÜ](ÿ±ÿßÿ®ÿ∑ URL)`.' },
            { code: 'ru-RU', name: 'Russian (Russia)', llm_prompt: '–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∏–¥–µ–∏ ou expandir o seguinte texto em russo:', llm_research_prompt: '–ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ –æ—Ç 3 –¥–æ 5 —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ä–∞–±–æ—Ç (–Ω–∞–∑–≤–∞–Ω–∏–µ e URL) –ø–æ —Ç–µ–º–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä—É—Å—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞. –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–π—Ç–µ –∏—Ö –∫–∞–∫ –Ω–µ—É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ Markdown, onde cada elemento –∏–º–µ–µ—Ç –≤–∏–¥ `[–ù–∞–∑–≤–∞–Ω–∏–µ](URL)`.' },
            { code: 'hi-IN', name: 'Hindi (India)', llm_prompt: '‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§™‡§æ‡§† ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•Å‡§õ ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§ï‡§∞‡•á‡§Ç ou expandir o seguinte texto em hindi:', llm_research_prompt: '‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§™‡§æ‡§† ‡§ï‡•á ‡§µ‡§ø‡§∑‡§Ø ‡§™‡§∞ 3 ‡§∏‡•á 5 ‡§™‡•ç‡§∞‡§æ‡§∏‡§Ç‡§ó‡§ø‡§ï ‡§∂‡•ã‡§ß ‡§™‡§§‡•ç‡§∞‡•ã‡§Ç (‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï e URL) ‡§ï‡•Ä ‡§∏‡•Ç‡§ö‡•Ä ‡§¨‡§®‡§æ‡§è‡§Ç‡•§ ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§Ü‡§á‡§ü‡§Æ ‡§ï‡•ã `[‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï](URL)` ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§Æ‡§æ‡§∞‡•ç‡§ï‡§°‡§æ‡§â‡§® ‡§Ö‡§®‡§ë‡§∞‡•ç‡§°‡§∞ ‡§∏‡•Ç‡§ö‡•Ä ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§æ‡§∞‡•Ç‡§™‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§' },
            { code: 'sv-SE', name: 'Svenska (Sweden)', llm_prompt: 'Generera id√©er ou ut√∂ka o seguinte texto em sueco:', llm_research_prompt: 'Lista 3 a 5 artigos de pesquisa relevantes (t√≠tulo e URL) sobre o t√≥pico do seguinte texto em sueco. Formate como uma lista n√£o ordenada de Markdown, com cada item sendo `[T√≠tulo](URL)`.' },
            { code: 'fi-FI', name: 'Suomi (Finland)', llm_prompt: 'Luo ideoita ou laajenna seuraavaa suomenkielist√§ teksti√§:', llm_research_prompt: 'Listaa 3-5 relevanttia tutkimuspaperia (otsikko e URL) seuraavan suomenkielisen tekstin aiheesta. Muotoile ne Markdown-j√§rjest√§m√§tt√∂m√§ksi listaksi, jossa cada kohta √© `[Otsikko](URL)`.' },
            { code: 'nl-NL', name: 'Dutch (Netherlands)', llm_prompt: 'Genereer idee√´n ou breid o seguinte texto em holand√™s:', llm_research_prompt: 'Lijst 3 tot 5 relevante onderzoekspapers (titel e URL) op over het onderwerp van de volgende Nederlandse tekst. Formatteer als een ongeordende Markdown-lijst, waarbij cada item `[Titel](URL)` is.' },
            { code: 'pl-PL', name: 'Polish (Poland)', llm_prompt: 'Generuj pomys≈Çy ou rozwi≈Ñ o seguinte texto em polaco:', llm_research_prompt: 'Wymie≈Ñ od 3 do 5 odpowiednich artyku≈Ç√≥w badawczych (tytu≈Ç e URL) na temat nastƒôpujƒÖcego polskiego tekstu. Sformatuj jako nieuporzƒÖdkowanƒÖ listƒô Markdown, onde cada elemento √© `[Tytu≈Ç](URL)`.' },
            { code: 'tr-TR', name: 'Turkish (Turkey)', llm_prompt: 'A≈üaƒüƒ±daki T√ºrk√ße metin i√ßin fikirler √ºretin ou metni geni≈ületin:', llm_research_prompt: 'A≈üaƒüƒ±daki T√ºrk√ße metin konusuyla ilgili 3 ila 5 adet ilgili ara≈ütƒ±rma makalesi (ba≈ülƒ±k e URL) listeleyin. Her √∂ƒüenin `[Ba≈ülƒ±k](URL)` olduƒüu bir Markdown sƒ±rasƒ±z liste olarak bi√ßimlenidirin.' },
            { code: 'da-DK', name: 'Danish (Denmark)', llm_prompt: 'Generer ideer ou udvid o seguinte texto em dinamarqu√™s:', llm_research_prompt: 'List 3 til 5 relevante forskningsartikler (titel e URL) om emnet for seguinte dinamarqu√™s texto. Formater como uma uordnet Markdown-liste, hvor cada elemento √© `[Titel](URL)`.' },
            { code: 'no-NO', name: 'Norwegian (Norway)', llm_prompt: 'Generer ideer ou udvid o seguinte texto em noruegu√™s:', llm_research_prompt: 'List 3 til 5 relevante forskningsartikler (titel e URL) om emnet for seguinte noruegu√™s texto. Formater como uma uordnet Markdown-liste, hvor cada elemento √© `[Titel](URL)`.' },
            { code: 'el-GR', name: 'Greek (Greece)', llm_prompt: 'ŒîŒ∑ŒºŒπŒøœÖœÅŒ≥ŒÆœÉœÑŒµ ŒπŒ¥Œ≠ŒµœÇ ou ŒµœÄŒµŒ∫œÑŒµŒØŒΩŒµœÑŒµ o seguinte texto em grego:', llm_research_prompt: 'ŒõŒØœÉœÑŒ± 3 Œ≠œâœÇ 5 œÉœáŒµœÑŒπŒ∫œéŒΩ ŒµœÅŒµœÖŒΩŒ∑œÑŒπŒ∫œéŒΩ ŒµœÅŒ≥Œ±œÉŒπœéŒΩ (œÑŒØœÑŒªŒøœÇ e URL) œÉœáŒµœÑŒπŒ∫Œ¨ com o tema do Œ±Œ∫œåŒªŒøœÖŒ∏ŒøœÖ ŒµŒªŒªŒ∑ŒΩŒπŒ∫Œøœç Œ∫ŒµŒπŒºŒ≠ŒΩŒøœÖ. ŒîŒπŒ±ŒºŒøœÅœÜœéœÉœÑŒµ œâœÇ uma ŒºŒ∑ œÑŒ±ŒæŒπŒΩŒøŒºŒ∑ŒºŒ≠ŒΩŒ∑ ŒªŒØœÉœÑŒ± Markdown, com cada œÉœÑŒøŒπœáŒµŒØŒø ŒΩŒ± √© `[Œ§ŒØœÑŒªŒøœÇ](URL)`.' },
            { code: 'he-IL', name: 'Hebrew (Israel)', llm_prompt: '◊¶◊ï◊® ◊®◊¢◊ô◊ï◊†◊ï◊™ ou ◊î◊®◊ó◊ë ◊ê◊™ ◊î◊ò◊ß◊°◊ò ◊î◊¢◊ë◊®◊ô ◊î◊ë◊ê:', llm_research_prompt: '◊®◊©◊ô◊û◊î ◊©◊ú 3 ◊¢◊ì 5 ◊û◊ê◊û◊®◊ô ◊û◊ó◊ß◊® ◊®◊ú◊ï◊ï◊†◊ò◊ô◊ô◊ù (◊õ◊ï◊™◊®◊™ e ◊õ◊™◊ï◊ë◊™ URL) ◊ë◊†◊ï◊©◊ê ◊î◊ò◊ß◊°◊ò ◊î◊¢◊ë◊®◊ô ◊î◊ë◊ê. ◊§◊®◊û◊ò ◊õ◊®◊©◊ô◊û◊î ◊ú◊ê ◊û◊°◊ï◊ì◊®◊™ ◊©◊ú Markdown, ◊õ◊ê◊©◊® cada ◊§◊®◊ô◊ò ◊î◊ï◊ê `[◊õ◊ï◊™◊®◊™](URL)`.' },
            { code: 'th-TH', name: 'Thai (Thailand)', llm_prompt: '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î ou ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ:', llm_research_prompt: '‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á 3 ‡∏ñ‡∏∂‡∏á 5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á e URL) ‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Markdown ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏≥‡∏î‡∏±‡∏ö ‡πÇ‡∏î‡∏¢ cada‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏≠ `[‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á](URL)`.' },
            { code: 'id-ID', name: 'Indonesian (Indonesia)', llm_prompt: 'Hasilkan ide ou perluas o seguinte texto em indon√©sio:', llm_research_prompt: 'Daftar 3 hingga 5 makalah penelitian yang relevan (judul e URL) tentang topik teks Bahasa Indonesia berikut. Format sebagai daftar Markdown tanpa urutan, com cada item berupa `[Judul](URL)`.' },
            { code: 'ms-MY', name: 'Malay (Malaysia)', llm_prompt: 'Jana idea ou kembangkan o seguinte texto em malaio:', llm_research_prompt: 'Senaraikan 3 hingga 5 kertas penyelidikan yang relevan (tajuk e URL) mengenai topik teks Bahasa Melayu berikut. Formatkan sebagai senarai tidak berurutan Markdown, com cada item √© `[Tajuk](URL)`.' },
            { code: 'vi-VN', name: 'Vietnamese (Vietnam)', llm_prompt: 'T·∫°o √Ω t∆∞·ªüng ou m·ªü r·ªông o seguinte texto em vietnamita:', llm_research_prompt: 'Li·ªát k√™ 3 ƒë·∫øn 5 b√†i b√°o nghi√™nquisa relacionados (ti√™u ƒë·ªÅ e URL) sobre o tema do texto vietnamita seguinte. ƒê·ªãnh d·∫°ng d∆∞·ªõi d·∫°ng danh s√°ch kh√¥ng c√≥ th·ª© t·ª± Markdown, com cada m·ª•c √© `[Ti√™u ƒë·ªÅ](URL)`.' },
            { code: 'cs-CZ', name: 'Czech (Czech Republic)', llm_prompt: 'Generujte n√°pady ou roz≈°i≈ôte o seguinte texto em checo:', llm_research_prompt: 'Uveƒète 3 a≈æ 5 relevantn√≠ch v√Ωzkumn√Ωch prac√≠ (n√°zev e URL) na t√©ma n√°sleduj√≠c√≠ho ƒçesk√©ho textu. Form√°tujte jako neuspo≈ô√°dan√Ω seznam Markdown, p≈ôiƒçem≈æ cada polo≈æka je `[N√°zev](URL)`.' },
            { code: 'hu-HU', name: 'Hungarian (Hungary)', llm_prompt: '√ñtleteket gener√°ljon ou b≈ëv√≠tse a k√∂vetkez≈ë magyar sz√∂veget:', llm_research_prompt: 'Soroljon fel 3-5 relev√°ns kutat√°si cikket (c√≠m e URL) a k√∂vetkez≈ë magyar sz√∂veg t√©m√°j√°ban. Form√°zza Markdown rendezetlen listak√©nt, onde cada elem `[C√≠m](URL)`.' },
            { code: 'ro-RO', name: 'Romanian (Romania)', llm_prompt: 'Genera»õi idei ou extinde»õi urmƒÉtorul texto em romeno:', llm_research_prompt: 'Lista»õi 3 p√¢nƒÉ la 5 articole de cercetare relevante (titlu e URL) pe tema urmƒÉtorului text √Æn limba rom√¢nƒÉ. Formata»õi ca uma lista neordonatƒÉ Markdown, com cada elemento sendo `[Titlu](URL)`.' },
            { code: 'sk-SK', name: 'Slovak (Slovakia)', llm_prompt: 'Generujte n√°pady ou roz≈°√≠rte nasleduj√∫ci texto em eslovaco:', llm_research_prompt: 'Uveƒète 3 a≈æ 5 relevantn√Ωch v√Ωskumn√Ωch pr√°c (n√°zev e URL) na t√©ma nasleduj√∫ceho slovensk√©ho textu. Form√°tujte ako neusporiadan√Ω zoznam Markdown, priƒçom cada polo≈æka je `[N√°zov](URL)`.' },
            { code: 'uk-UA', name: 'Ukrainian (Ukraine)', llm_prompt: '–ó–≥–µ–Ω–µ—Ä—É–π—Ç–µ —ñ–¥–µ—ó ou —Ä–æ–∑—à–∏—Ä—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π texto em ucraniano:', llm_research_prompt: '–ü–µ—Ä–µ–ª—ñ—á—ñ—Ç—å 3-5 –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏—Ö –Ω–∞—É–∫–æ–≤–∏—Ö —Å—Ç–∞—Ç–µ–π (–Ω–∞–∑–≤–∞ e URL) –Ω–∞ —Ç–µ–º—É –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç—É. –í—ñ–¥—Ñ–æ—Ä–º–∞—Ç—É–π—Ç–µ —è–∫ –Ω–µ–≤–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫ Markdown, onde cada elemento tem –≤–∏–≥–ª—è–¥ `[–ù–∞–∑–≤–∞](URL)`.' },
        ];

        // Inicializar SpeechSynthesisUtterance e API SpeechSynthesis
        const synth = window.speechSynthesis;
        let allAvailableVoices = []; // Array para guardar todas as vozes dispon√≠veis do navegador

        // API key para Gemini API (string vazia para ambiente Canvas)
        const apiKey = ""; // Ser√° fornecida pelo ambiente Canvas em tempo de execu√ß√£o
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

        // --- Fun√ß√µes Utilit√°rias ---

        /**
         * Exibe uma mensagem na caixa de mensagem.
         * @param {string} message - A mensagem a ser exibida.
         * @param {string} type - O tipo de mensagem (ex: 'info', 'error', 'warning', 'success', 'loading').
         */
        function showMessage(message, type = 'info') {
            messageBox.textContent = message;
            messageBox.className = 'mt-4 mb-6 p-4 rounded-lg'; // Redefinir classes
            messageBox.classList.remove('hidden'); // Garantir que est√° vis√≠vel

            // Aplicar estilo espec√≠fico com base no tipo de mensagem
            if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'border', 'border-red-400', 'text-red-800');
            } else if (type === 'warning') {
                // Corre√ß√£o: Removido o par√™ntese extra aqui
                messageBox.classList.add('bg-yellow-100', 'border', 'border-yellow-400', 'text-yellow-800');
            } else if (type === 'success') {
                messageBox.classList.add('bg-green-100', 'border', 'border-green-400', 'text-green-800');
            } else if (type === 'loading') {
                messageBox.classList.add('bg-blue-100', 'border', 'border-blue-400', 'text-blue-800');
                // Adicionar anima√ß√£o de pontos de carregamento
                messageBox.innerHTML = `<span>${message}</span> <span class="dot-pulse-dot">.</span><span class="dot-pulse-dot">.</span><span class="dot-pulse-dot">.</span>`;
            } else { // Padr√£o para info
                messageBox.classList.add('bg-blue-100', 'border', 'border-blue-400', 'text-blue-800');
            }
        }

        /**
         * Oculta a caixa de mensagem.
         */
        function hideMessageBox() {
            messageBox.classList.add('hidden');
        }

        /**
         * Preenche os menus suspensos de sele√ß√£o de idioma para todos os pain√©is.
         */
        function populateLanguageSelects() {
            languageAreas.forEach((area, index) => {
                area.langSelect.innerHTML = ''; // Limpar op√ß√µes existentes

                // Adicionar uma op√ß√£o padr√£o "Selecionar Idioma"
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'Selecionar um idioma...';
                defaultOption.disabled = true;
                defaultOption.selected = true;
                area.langSelect.appendChild(defaultOption);

                supportedLanguages.forEach(lang => {
                    const option = document.createElement('option');
                    option.value = lang.code;
                    option.textContent = lang.name;
                    area.langSelect.appendChild(option);
                });
                // Definir idiomas padr√£o para cada painel e atualizar suas etiquetas
                if (index === 0) area.langSelect.value = 'en-US';
                if (index === 1) area.langSelect.value = 'de-DE';
                if (index === 2) area.langSelect.value = 'sv-SE';
                if (index === 3) area.langSelect.value = 'fi-FI';

                // Atualizar imediatamente a voz, o idioma de reconhecimento e a etiqueta para este painel
                updateVoiceAndRecognitionLanguage(area);
            });
        }

        /**
         * Atualiza a voz TTS, o idioma de reconhecimento STT e a etiqueta do painel para uma √°rea espec√≠fica.
         * @param {object} area - O objeto da √°rea de idioma a ser atualizado.
         */
        function updateVoiceAndRecognitionLanguage(area) {
            const selectedLangCode = area.langSelect.value;
            const selectedLang = supportedLanguages.find(l => l.code === selectedLangCode);

            // Atualizar a etiqueta din√¢mica
            if (selectedLang) {
                area.langLabel.textContent = selectedLang.name;
            } else {
                area.langLabel.textContent = 'Selecionar Idioma'; // Fallback
            }

            // Atualizar a voz TTS para esta √°rea
            const voice = allAvailableVoices.find(v => v.lang === selectedLangCode || v.lang.startsWith(selectedLangCode.substring(0,2)));
            if (voice) {
                area.currentVoice = voice;
            } else {
                area.currentVoice = null;
                console.warn(`Nenhuma voz TTS espec√≠fica encontrada para ${selectedLangCode} no painel. Revertendo para voz padr√£o ou geral.`);
            }

            // Atualizar o idioma de reconhecimento STT para esta √°rea
            if (area.recognition) {
                area.recognition.lang = selectedLangCode;
            }
        }

        /**
         * Preenche as vozes dispon√≠veis para TTS para todos os pain√©is.
         */
        function populateVoiceList() {
            allAvailableVoices = synth.getVoices();
            // Ap√≥s o carregamento das vozes, garantir que todas as √°reas de idioma sejam atualizadas
            languageAreas.forEach(area => updateVoiceAndRecognitionLanguage(area));

            if (allAvailableVoices.length === 0) {
                languageAreas.forEach(area => {
                    area.speakButton.disabled = true;
                });
                showMessage('Nenhuma voz TTS encontrada. O seu navegador pode n√£o suportar SpeechSynthesis ou n√£o ter vozes instaladas.', 'error');
            } else {
                // Verificar se pelo menos uma voz est√° dispon√≠vel para o idioma selecionado de cada painel
                languageAreas.forEach(area => {
                    const selectedLangCode = area.langSelect.value;
                    const hasVoice = allAvailableVoices.some(v => v.lang === selectedLangCode || v.lang.startsWith(selectedLangCode.substring(0,2)));
                    area.speakButton.disabled = !hasVoice;
                });
                hideMessageBox();
            }
        }

        // Ouvinte de evento para quando as vozes s√£o carregadas (importante para compatibilidade entre navegadores)
        if (synth.onvoiceschanged !== undefined) {
            synth.onvoiceschanged = populateVoiceList;
        } else {
            // Fallback para navegadores que n√£o disparam onvoiceschanged imediatamente
            populateVoiceList();
        }

        // --- Fun√ß√µes da API Gemini (LLM) ---

        /**
         * Gera ideias ou expande o texto usando a API Gemini.
         * @param {string} text - O texto base para gerar ideias.
         * @param {object} area - O objeto da √°rea de idioma que acionou a gera√ß√£o.
         * @returns {Promise<string>} - Uma promessa que resolve com o texto gerado.
         */
        async function generateIdeas(text, area) {
            if (!text.trim()) {
                showMessage('Por favor, introduza algum texto para gerar ideias!', 'warning');
                return '';
            }

            const selectedLangCode = area.langSelect.value;
            const selectedLang = supportedLanguages.find(l => l.code === selectedLangCode);
            const llmPromptTemplate = selectedLang ? selectedLang.llm_prompt : 'Generate some ideas or expand the following text:';

            const prompt = `${llmPromptTemplate} "${text}"`;

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });

            const payload = { contents: chatHistory };

            try {
                area.llmButton.textContent = 'A gerar...';
                area.llmButton.disabled = true;
                disableAllButtons(); // Desabilitar todos os bot√µes enquanto o LLM est√° a trabalhar
                showMessage('A gerar ideias...', 'loading');

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const responseText = await response.text(); // Sempre obter a resposta como texto primeiro

                if (!response.ok) {
                    let errorMessage = `Erro da API Gemini: ${response.status} ${response.statusText}`;
                    try {
                        const errorData = JSON.parse(responseText);
                        errorMessage += ` - ${errorData.error?.message || 'Erro desconhecido'}`;
                    } catch (parseError) {
                        errorMessage += ` - Resposta bruta (n√£o JSON): "${responseText}"`;
                    }
                    throw new Error(errorMessage);
                }

                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (parseError) {
                    throw new Error(`Resposta JSON inv√°lida da API Gemini: "${responseText}"`);
                }

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const generatedText = result.candidates[0].content.parts[0].text.trim();
                    area.textArea.value += '\n\n' + generatedText; // Adicionar ao texto existente
                    showMessage('Ideias geradas com sucesso!', 'success');
                    return generatedText;
                } else {
                    throw new Error('Gera√ß√£o de ideias falhou: Estrutura de resposta da API inesperada ou conte√∫do vazio.');
                }
            } catch (error) {
                console.error('Chamada da API Gemini (gerar ideias) falhou:', error);
                showMessage(`Erro ao gerar ideias: ${error.message}. Por favor, tente novamente.`, 'error');
                return '';
            } finally {
                area.llmButton.textContent = '‚ú® Gerar Ideias ‚ú®';
                area.llmButton.disabled = false;
                enableAllButtons(); // Reabilitar todos os bot√µes
            }
        }

        /**
         * Pesquisa e exibe links de artigos cient√≠ficos usando a API Gemini.
         * @param {string} text - O texto base para a pesquisa.
         * @param {object} area - O objeto da √°rea de idioma que acionou a pesquisa.
         */
        async function searchResearchPapers(text, area) {
            if (!text.trim()) {
                showMessage('Por favor, introduza algum texto para pesquisar artigos!', 'warning');
                return;
            }

            const selectedLangCode = area.langSelect.value;
            const selectedLang = supportedLanguages.find(l => l.code === selectedLangCode);
            const llmResearchPromptTemplate = selectedLang ? selectedLang.llm_research_prompt : 'List 3 to 5 relevant research papers (title and URL) on the topic of the following text. Format as a Markdown unordered list, with each item being `[Title](URL)`.';

            const prompt = `${llmResearchPromptTemplate} "${text}"`;

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });

            const payload = { contents: chatHistory };

            try {
                area.researchButton.textContent = 'A pesquisar...';
                area.researchButton.disabled = true;
                disableAllButtons(); // Desabilitar todos os bot√µes enquanto o LLM est√° a trabalhar
                showMessage('A pesquisar artigos cient√≠ficos...', 'loading');
                area.researchLinksDiv.innerHTML = 'A carregar links...'; // Limpa e mostra status

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const responseText = await response.text();

                if (!response.ok) {
                    let errorMessage = `Erro da API Gemini: ${response.status} ${response.statusText}`;
                    try {
                        const errorData = JSON.parse(responseText);
                        errorMessage += ` - ${errorData.error?.message || 'Erro desconhecido'}`;
                    } catch (parseError) {
                        errorMessage += ` - Resposta bruta (n√£o JSON): "${responseText}"`;
                    }
                    throw new Error(errorMessage);
                }

                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (parseError) {
                    throw new Error(`Resposta JSON inv√°lida da API Gemini: "${responseText}"`);
                }

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const generatedText = result.candidates[0].content.parts[0].text.trim();
                    const links = extractMarkdownLinks(generatedText);

                    if (links.length > 0) {
                        let linksHtml = '<p class="font-bold mb-2">Artigos Encontrados:</p><ul>';
                        links.forEach(link => {
                            linksHtml += `<li><a href="${link.url}" target="_blank" rel="noopener noreferrer">${link.title}</a></li>`;
                        });
                        linksHtml += '</ul>';
                        area.researchLinksDiv.innerHTML = linksHtml;
                        showMessage('Artigos cient√≠ficos encontrados com sucesso!', 'success');
                    } else {
                        area.researchLinksDiv.innerHTML = '<p>Nenhum artigo encontrado ou formato inesperado.</p>';
                        showMessage('Nenhum artigo encontrado. Tente refinar o seu texto.', 'warning');
                    }
                    return generatedText;
                } else {
                    throw new Error('Pesquisa de artigos falhou: Estrutura de resposta da API inesperada ou conte√∫do vazio.');
                }
            } catch (error) {
                console.error('Chamada da API Gemini (pesquisa de artigos) falhou:', error);
                area.researchLinksDiv.innerHTML = `<p class="text-red-600">Erro: ${error.message}</p>`;
                showMessage(`Erro ao pesquisar artigos: ${error.message}. Por favor, tente novamente.`, 'error');
                return '';
            } finally {
                area.researchButton.textContent = 'üî¨ Pesquisar Artigos Cient√≠ficos üî¨';
                area.researchButton.disabled = false;
                enableAllButtons(); // Reabilitar todos os bot√µes
            }
        }

        /**
         * Extrai links no formato Markdown ([T√≠tulo](URL)) de uma string.
         * @param {string} text - O texto contendo links Markdown.
         * @returns {Array<{title: string, url: string}>} - Um array de objetos com t√≠tulo e URL.
         */
        function extractMarkdownLinks(text) {
            const regex = /\[(.*?)\]\((.*?)\)/g;
            let matches;
            const links = [];
            while ((matches = regex.exec(text)) !== null) {
                links.push({
                    title: matches[1],
                    url: matches[2]
                });
            }
            return links;
        }

        /**
         * Desabilita todos os bot√µes em todos os pain√©is.
         */
        function disableAllButtons() {
            languageAreas.forEach(a => {
                a.speakButton.disabled = true;
                a.recordButton.disabled = true;
                a.llmButton.disabled = true;
                a.researchButton.disabled = true;
                a.stopSpeakButton.disabled = true; // Desabilitar o bot√£o de parar de falar tamb√©m
            });
        }

        /**
         * Reabilita todos os bot√µes em todos os pain√©is.
         */
        function enableAllButtons() {
            languageAreas.forEach(a => {
                a.speakButton.disabled = !a.currentVoice; // Re-desabilitar se n√£o houver voz
                if (a.recognition) a.recordButton.disabled = false;
                a.llmButton.disabled = false;
                a.researchButton.disabled = false;
                // O bot√£o de parar de falar s√≥ deve ser habilitado se a fala estiver ativa
                a.stopSpeakButton.disabled = !synth.speaking;
            });
        }


        // --- Ouvintes de Eventos e Inicializa√ß√£o ---

        languageAreas.forEach((area, index) => {
            // Ouvinte de evento de altera√ß√£o de sele√ß√£o de idioma
            area.langSelect.addEventListener('change', () => {
                updateVoiceAndRecognitionLanguage(area);
                // Reabilitar o bot√£o de falar se uma voz estiver agora dispon√≠vel
                area.speakButton.disabled = !area.currentVoice;
            });

            // Ouvinte de evento do bot√£o Falar (TTS)
            area.speakButton.addEventListener('click', () => {
                // Parar qualquer fala em andamento para evitar sobreposi√ß√£o
                if (synth.speaking) {
                    synth.cancel();
                }

                const text = area.textArea.value.trim();
                if (!text) {
                    showMessage('Por favor, introduza algum texto para sintetizar!', 'warning');
                    return;
                }

                if (!area.currentVoice) {
                    showMessage(`Nenhuma voz dispon√≠vel para ${area.langSelect.value}. Por favor, selecione outro idioma ou verifique as configura√ß√µes do navegador.`, 'error');
                    return;
                }

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.voice = area.currentVoice;
                utterance.lang = area.langSelect.value; // Garantir que a fala use o idioma selecionado
                utterance.pitch = 1; // Tom padr√£o (0 a 2)
                utterance.rate = 1;  // Velocidade padr√£o (0.1 a 10)

                utterance.onstart = () => {
                    area.speakButton.innerHTML = '<span class="flex items-center justify-center">üîä Falando...</span>';
                    disableAllButtons(); // Desabilitar todos os bot√µes durante a fala
                    area.stopSpeakButton.disabled = false; // Habilitar o bot√£o de parar de falar
                    hideMessageBox();
                };

                utterance.onend = () => {
                    area.speakButton.innerHTML = '<span class="flex items-center justify-center">üîä Falar</span>';
                    enableAllButtons(); // Reabilitar todos os bot√µes ap√≥s o t√©rmino da fala
                };

                utterance.onerror = (event) => {
                    area.speakButton.innerHTML = '<span class="flex items-center justify-center">üîä Falar</span>';
                    enableAllButtons(); // Reabilitar todos os bot√µes ap√≥s erro na fala
                    showMessage(`Erro de s√≠ntese de fala para ${area.langSelect.value}: ${event.error}`, 'error');
                    console.error('SpeechSynthesisUtterance.onerror', event);
                };

                synth.speak(utterance);
            });

            // Ouvinte de evento do bot√£o Parar de Falar
            area.stopSpeakButton.addEventListener('click', () => {
                if (synth.speaking) {
                    synth.cancel(); // Interrompe qualquer fala em andamento
                    showMessage('Fala interrompida.', 'info');
                    // O onend do utterance ser√° chamado, que reabilitar√° os bot√µes
                }
            });


            // Ouvinte de evento do bot√£o Gravar (STT)
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (SpeechRecognition) {
                area.recognition = new SpeechRecognition();
                area.recognition.continuous = false; // Parar ap√≥s uma √∫nica fala
                area.recognition.interimResults = false; // Retornar apenas resultados finais
                area.recognition.lang = area.langSelect.value; // Definir idioma inicial com base no menu suspenso

                // Manipulador de evento para quando a fala √© reconhecida
                area.recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    area.textArea.value = transcript; // Colocar o texto reconhecido na √°rea de texto
                    showMessage(`Voz reconhecida no Painel de ${area.langLabel.textContent}!`, 'success');
                };

                // Manipulador de evento para quando o reconhecimento termina
                area.recognition.onend = () => {
                    area.recordButtonText.textContent = 'Gravar';
                    area.micIcon.classList.remove('animate-pulse-red'); // Parar de pulsar
                    area.recordButton.classList.remove('bg-red-600', 'hover:bg-red-700'); // Redefinir cor do bot√£o
                    area.recordButton.classList.add('from-green-500', 'to-teal-600', 'hover:from-green-600', 'hover:to-teal-700');
                    enableAllButtons(); // Reabilitar todos os bot√µes ap√≥s o t√©rmino da grava√ß√£o
                };

                // Manipulador de evento para erros durante o reconhecimento
                area.recognition.onerror = (event) => {
                    area.recordButtonText.textContent = 'Gravar';
                    area.micIcon.classList.remove('animate-pulse-red'); // Parar de pulsar
                    area.recordButton.classList.remove('bg-red-600', 'hover:bg-red-700'); // Redefinir cor do bot√£o
                    area.recordButton.classList.add('from-green-500', 'to-teal-600', 'hover:from-green-600', 'hover:to-teal-700');
                    enableAllButtons(); // Reabilitar todos os bot√µes ap√≥s erro de grava√ß√£o

                    let errorMessage = `Erro de reconhecimento de fala no Painel de ${area.langLabel.textContent}. `;
                    switch (event.error) {
                        case 'not-allowed':
                            errorMessage += 'Por favor, permita o acesso ao microfone nas configura√ß√µes do seu navegador.';
                            break;
                        case 'no-speech':
                            errorMessage += 'Nenhuma fala foi detetada. Por favor, tente novamente.';
                            break;
                        case 'audio-capture':
                            errorMessage += 'Microfone n√£o encontrado ou n√£o p√¥de ser acedido.';
                            break;
                        case 'network':
                            errorMessage += 'Erro de rede. Por favor, verifique a sua conex√£o com a internet.';
                            break;
                        default:
                            errorMessage += `Erro: ${event.error}`;
                    }
                    showMessage(errorMessage, 'error');
                    console.error('SpeechRecognition.onerror', event);
                };

                area.recordButton.addEventListener('click', () => {
                    // Parar qualquer fala em andamento antes de gravar
                    if (synth.speaking) {
                        synth.cancel();
                    }
                    try {
                        // Parar quaisquer outros reconhecimentos ativos
                        languageAreas.forEach(a => {
                            if (a.recognition && a.recognition !== area.recognition) {
                                a.recognition.stop(); // Parar outros reconhecimentos
                            }
                        });

                        area.recognition.start(); // Come√ßar a ouvir a fala neste painel
                        area.recordButtonText.textContent = 'A ouvir...';
                        area.micIcon.classList.add('animate-pulse-red'); // Adicionar efeito de pulsa√ß√£o
                        area.recordButton.classList.remove('from-green-500', 'to-teal-600', 'hover:from-green-600', 'hover:to-teal-700');
                        area.recordButton.classList.add('bg-red-600', 'hover:bg-red-700'); // Mudar a cor do bot√£o para indicar grava√ß√£o

                        disableAllButtons(); // Desabilitar todos os bot√µes durante a grava√ß√£o ativa
                        area.recordButton.disabled = false; // Reabilitar o bot√£o de grava√ß√£o ativo atual

                        showMessage(`Fale agora no Painel de ${area.langLabel.textContent}...`, 'info');
                    } catch (e) {
                        showMessage('N√£o foi poss√≠vel iniciar o microfone. Por favor, certifique-se de que nenhuma outra aplica√ß√£o o est√° a usar.', 'error');
                        console.error('Erro ao iniciar o reconhecimento de fala:', e);
                        enableAllButtons(); // Reabilitar os bot√µes se o in√≠cio do reconhecimento falhar
                    }
                });
            } else {
                // Se SpeechRecognition n√£o for suportado para este navegador
                area.recordButton.disabled = true;
                area.recordButtonText.textContent = 'N√£o Suportado';
                area.recordButton.classList.remove('from-green-500', 'to-teal-600');
                area.recordButton.classList.add('bg-gray-400', 'cursor-not-allowed');
                area.micIcon.classList.add('hidden');
                // Exibir esta mensagem apenas uma vez globalmente
                if (!document.querySelector('.stt-unsupported-message')) {
                    showMessage('O seu navegador n√£o suporta totalmente o Reconhecimento de Fala. A entrada de voz pode n√£o funcionar.', 'warning');
                    messageBox.classList.add('stt-unsupported-message'); // Adicionar uma classe para evitar mensagens duplicadas
                }
            }

            // Ouvinte de evento do bot√£o LLM de ideias
            area.llmButton.addEventListener('click', async () => {
                const text = area.textArea.value.trim();
                await generateIdeas(text, area);
            });

            // Ouvinte de evento do bot√£o de pesquisa de artigos
            area.researchButton.addEventListener('click', async () => {
                const text = area.textArea.value.trim();
                await searchResearchPapers(text, area);
            });
        });

        // Configura√ß√£o inicial
        populateLanguageSelects(); // Preencher todos os menus suspensos de idioma e definir as etiquetas iniciais
        populateVoiceList(); // Preencher as vozes ap√≥s a defini√ß√£o dos idiomas

        // Definir texto inicial em cada √°rea
        languageAreas[0].textArea.value = "Ol√°, aventureiro! Este √© o painel de Ingl√™s.";
        languageAreas[1].textArea.value = "Hallo Abenteurer! Dies ist das deutsche Panel.";
        languageAreas[2].textArea.value = "Hej √§ventyrare! Detta √§r den svenska panelen.";
        languageAreas[3].textArea.value = "Hei seikkailija! T√§m√§ on suomenkielinen paneeli.";

    </script>
</body>
</html>
